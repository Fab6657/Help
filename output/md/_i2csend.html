<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>I2CSend</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_i2c_software.html" title="I2C Software"><link rel="prev" href="_i2crestart.html" title="I2CRestart"><link rel="next" href="_i2cstart.html" title="I2CStart"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_i2csend"></a>I2CSend</h4></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="screen">	I2CSend <span class="emphasis"><em>data</em></span>
	I2CSend <span class="emphasis"><em>data</em></span>, <span class="emphasis"><em>ack</em></span></pre><p><span class="strong"><strong>Command Availability:</strong></span></p><p>Available on all microcontrollers except 12 bit instruction Microchip PIC microcontrollers (10F,
12F5xx, 16F5xx chips)</p><p><span class="strong"><strong>Explanation:</strong></span></p><p>The I2CSend command will send <span class="emphasis"><em>data</em></span> through the I2C connection. If
<code class="literal"><span class="emphasis"><em>ack</em></span></code> is TRUE, or no value is given for <code class="literal"><span class="emphasis"><em>ack</em></span></code>, then <code class="literal">I2CSend</code> will wait
for an Ack from the receiver before continuing.
If in master mode, <code class="literal">I2CSend</code> will send the data immediately. If in slave
mode, <code class="literal">I2CSend</code> will wait for the master to request the data before
sending.</p><p><span class="strong"><strong>Example 1:</strong></span></p><pre class="screen">	' I2CSend - using the ChipIno board, see here for information.
	' This program send commands to a GCB Slave with three LEDs attached.

	#chip 16F886, 8
	#config MCLRE_ON

	'I2C settings
	#define I2C_MODE Master
	#define I2C_DATA PORTC.4
	#define I2C_CLOCK PORTC.3
	#define I2C_BIT_DELAY 20 us
	#define I2C_CLOCK_DELAY 30 us


	#define I2C_ADDRESS 0x60      ;address of the slave device
	;----- Variables

	dim reg as byte

	;----- Program

	do

	  for reg = 0 to 2            ;three LEDs to control
		I2CStart                  ;take control of the bus
		I2CSend I2C_ADDRESS       ;address the device
		if I2CSendState = ACK then
		  I2CSend reg               ;address the particular register
		  I2CSend ON                ;command to turn on LED
		end if
		I2CStop                   ;relinquish the bus
		wait  100 ms
	  next reg
	  wait 1 S                  ;pause to show results

	  for reg = 0 to 2            ;similarly, turn them off
		I2CStart                  ;take control of the bus
		I2CSend I2C_ADDRESS       ;address the device
		if I2CSendState = ACK then
		  I2CSend reg               ;address the particular register
		  I2CSend OFF               ;command to turn off LED
		end if
		I2CStop                   ;relinquish the bus
		wait  100 ms
	  next reg
	  wait 1 S                  ;pause to show results

	loop</pre><p><span class="strong"><strong>Example 2:</strong></span></p><pre class="screen">	'This program will act as an I2C analog to digital converter
	'When data is requested from address 83, registers 0 through
	'3, it will return the value of AN0 through AN3.

	'Chip model
	#chip 16F88, 8

	'I2C settings
	#define I2C_MODE Slave
	#define I2C_CLOCK PORTB.0
	#define I2C_DATA PORTB.1

	#define I2C_DISABLE_INTERRUPTS ON

	'Main loop
	Do
		'Wait for start condition
		I2CStart

		'Get address
		I2CReceive Address
		If Address = 83 Then
			'If address was this device's address, respond
			I2CReceive Register

			OutValue = ReadAD(Register)
			I2CSend OutValue
		End If

		I2CStop

		Wait 5 ms
	Loop</pre><p>Supported in &lt;I2C.H&gt;</p></div></body></html>